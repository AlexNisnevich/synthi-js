<html>
<head>
  <!-- This includes Flocking and all its dependencies, including jQuery 2.1.3 and Infusion -->
  <script src="lib/flocking/dist/flocking-all.js"></script>
  <script src="lib/jQuery-Knob/dist/jquery.knob.min.js"></script>

  <script>
    var environment = flock.init();

    var tables = {
      ramp: flock.fillTable(64, flock.tableGenerators.saw).map(function (x) {return -x;}), // backwards sawtooth
      sin: function (shape) {
        if (shape >= 5) {
          var rectification = (shape - 5) / 5;
          return flock.fillTable(64, flock.tableGenerators.sin).map(function (x) {
            return x * (1 - rectification) + (Math.abs(x)) * rectification;
          });
        } else {
          var rectification = (5 - shape) / 5;
          return flock.fillTable(64, flock.tableGenerators.sin).map(function (x) {
            return x * (1 - rectification) + (-Math.abs(x)) * rectification;
          });
        }
      }
    }

    var pin1 = flock.synth({
      synthDef: {
        id: "pin1",
        ugen: "flock.ugen.sinOsc",
        freq: 440,
        mul: 0.1
      }
    });

    var pin2 = flock.synth({
      synthDef: {
        id: "pin2",
        ugen: "flock.ugen.osc",
        table: tables.ramp,
        freq: 440,
        mul: 0.1,
        options: {
            interpolation: "linear"
        }
      }
    });

    environment.start();

    $(function () {
      $(".dialOsc1Freq").knob({
        'change': function (v) { pin1.set("pin1.freq", v); pin2.set("pin2.freq", v); }
      });

      $(".dialOsc1Shape").knob({
        'change': function (v) { pin1.set("pin1.table", tables.sin(v)); }
      });

      $(".dialOsc1SinLevel").knob({
        'change': function (v) { pin1.set("pin1.mul", v / 10); }
      });

      $(".dialOsc1RampLevel").knob({
        'change': function (v) { pin2.set("pin2.mul", v / 10); }
      });
    })
  </script>
</head>
<body>
  <input type="text" value="440" class="dialOsc1Freq" data-min="40" data-max="10000">
  <input type="text" value="5" class="dialOsc1Shape" data-min="0" data-max="10">
  <input type="text" value="1" class="dialOsc1SinLevel" data-min="0" data-max="10">
  <input type="text" value="1" class="dialOsc1RampLevel" data-min="0" data-max="10">
</body>
</html>